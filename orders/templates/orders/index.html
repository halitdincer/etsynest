{% include 'etsynest/base.html' %}
{% load static %}

{% block 'STYLES' %}
  <link rel="stylesheet" href="{% static 'css/dataTables.bootstrap4.min.css' %}">
  <link rel="stylesheet" href="https://cdn.datatables.net/datetime/1.1.0/css/dataTables.dateTime.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/rowgroup/1.1.3/css/rowGroup.bootstrap.min.css">
{% endblock %}

{% block 'BODY' %}



<div class="container-fluid p-5">

  <div class="row mt-5">
    <div class="col-12">
      <!--<h1 class="display-1">Printify+</h1>-->
      <h5>There are {{ orders|length }} orders in total</h5>
    </div>
  </div>

  <div class="row">
    <div class="col-12">

    <table id="order-table" class="table table-hover table-bordered" style="width:100%">
        <thead class="">
          <tr>
            <th>Order ID</th>
            <th>Created At</th>
            <th>Customer Name</th>
            <th>Price</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    </div>
  </div>



</div>

{% endblock %}

{% block 'SCRIPTS' %}

<!-- DataTables Script -->
<script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/dataTables.bootstrap4.min.js'%}"></script>

<script type="text/javascript" src="{% static 'js/moment.min.js'%}"></script>
<script type="text/javascript" src="{% static 'js/dataTables.rowGroup.min.js'%}"></script>
<script type="text/javascript" src="https://cdn.datatables.net/datetime/1.1.0/js/dataTables.dateTime.min.js"></script>


<script type="text/javascript">

const ID_COLUMN = 0;
const DATE_COLUMN = 1;
const NAME_COLUMN = 2;

var table = document.getElementById("order-table");

$('#order-table thead tr').clone(true).appendTo( '#order-table thead' );
  $('#order-table thead tr:eq(1) th').each( function (i) {
      var title = $(this).text();
      $(this).html( '<input id="'+ title.replace(/\s+/g, '-').toLowerCase() +'input" type="text" placeholder="Search '+title+'" />' );
      $( 'input', this ).on( 'keyup change', function () {
          if ( order_table.column(i).search() !== this.value ) {
              order_table
                  .column(i)
                  .search( this.value )
                  .draw();
          }
      } );
  } );

  $.fn.dataTable.ext.errMode = 'throw';

  var order_table = $('#order-table').DataTable(
    {
      "order": [[ DATE_COLUMN, "desc" ]],
      "columnDefs": [
            { "type" : 'date', 'targets': [DATE_COLUMN] },
            {
                "targets": [ ID_COLUMN],
                "visible": true
            },
      ],
      "rowGroup": {
        "dataSrc": [[ DATE_COLUMN]],
      },
      "processing": true,
      "serverSide": false,
      "ajax": {
              headers: { "X-CSRFToken": '{{csrf_token}}' },
              url: "{% url 'orders_index' %}",
              method: "POST",
          },
    }
  );

  $('#order-table tbody').on('click', 'tr', function () {
      var data = $('#order-table tbody').row( this ).data();
      //window.open('./' + data[ID_COLUMN], 'name'); 
      window.open('./' + data[ID_COLUMN]); 
    } );


</script>


{% endblock %}

